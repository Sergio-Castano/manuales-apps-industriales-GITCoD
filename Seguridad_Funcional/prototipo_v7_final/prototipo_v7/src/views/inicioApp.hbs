<div class="my-body-area">
    <div class="section-left">
        <div class="top-half-left">
            <div id="profile-pic" class="profile-pic"></div>
            <div id="user-name" class="user-name">Nombre Apellido</div>
            <div id="user-email" class="user-email">email@ejemplo.com</div>
        </div>
        <div class="bottom-half-left">
            <div class="stage">
                1. Preparación
            </div>
            <div class="stage">
                2. Bloqueo
            </div>
            <div class="stage">
                3. Intervención
            </div>
            <div class="stage">
                4. Desbloqueo
            </div>
            <div class="stage">
                5. Puesta a punto
            </div>
            <div class="stage">
                6. Entrega
            </div>
        </div>
    </div>
    <div class="section-right">
        <div class="top-half-right">
            <div style="padding-left: 40px; color: white; font-weight: bold; font-size: 2rem;">Asistente de
                mantenimiento</div>
            <div style="padding-right: 40px;">
                <a href="/" style="color: white; text-decoration: none;">Logout</a>
            </div>
        </div>

        <div class="bottom-half-right">
            <div class="info-container mt-5">
                <div style="width: 100%; height: 100%;">
                    {{#if datosFiltrados}}
                    <div class="container py-4 rounded-4" style="color:black; width: 70%; margin-top: 3rem;">
                        <p class="text-center mb-3 mt-3" style="font-size: 2.5rem; font-weight: 400; ">Bienvenido
                            {{usuario.name}}</p>
                        <div class="container py-2" style="width: 90%;">
                            <form action="/iniciar/{{usuario._id}}" method="POST">
                                <p class="fs-4" style="text-align: justify;"> Seleccione de la lista el proceso de
                                    mantenimiento a ejecutar:</p>
                                <select class="form-select fs-5" aria-label="Default select example" name="option"
                                    onchange="removePlaceholder(this)" required>
                                    <option value="0" selected disabled hidden>Desplegar lista</option>
                                    {{#each datosFiltrados}}
                                    <option value="{{_id}}"> Maquina {{machine}} - {{type}} - {{section}} -
                                        {{prog_date_start}}</option>
                                    {{/each}}
                                </select>
                                <div class="d-grid gap-2 d-md-flex justify-content-md-center"
                                    style="margin-top: 1.5rem;">
                                    <button class="btn btn-secondary btn-lg" type="submit"> Continuar </button>
                                </div>
                            </form>
                        </div>
                    </div>
                    {{else}}

                    <div class="container py-4 rounded-4" style="width: 60%; background:white; margin-top: 3rem;">
                        <p class="text-center mb-3 mt-3" style="font-size: 2.5rem; font-weight: 400; ">Bienvenido
                            {{usuario.name}}</p>
                        <div class="container py-2" style="width: 90%;">
                            <form action="/iniciar" method="POST">
                                <p class="fs-4" style="text-align: justify;">Usted no cuenta con procedimientos
                                    autorizados. Por favor comuníquese con el departamento encargado</p>
                            </form>
                        </div>
                    </div>
                    {{/if}}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    setUserProfile("{{usuario.picture}}", "{{usuario.name}}", "{{usuario.email}}")
</script>

<script>
    const stages = document.querySelectorAll('.stage');
    const progressMessage = document.getElementById('progress-message');
    let currentStage = 1;

    function updateStage(stage) {
        stages.forEach((element, index) => {
            if (index + 1 < stage) {
                element.classList.add('completed');
                element.classList.remove('active');
            } else if (index + 1 === stage) {
                element.classList.add('active');
                element.classList.remove('completed');
            } else {
                element.classList.remove('active', 'completed');
            }
        });
    }

    updateStage(currentStage);
</script>

<script>
    function removePlaceholder(selectElement) {
        const placeholderOption = selectElement.querySelector('option[value="0"]');
        if (placeholderOption) {
            placeholderOption.remove();
        }
    }
</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const form = document.querySelector("form");
        const selectElement = document.querySelector("select[name='option']");

        form.onsubmit = function (event) {
            if (selectElement.value === "0") {
                event.preventDefault();
                alert("Por favor, selecciona una opción válida antes de continuar.");
            }
        };
    });
</script>