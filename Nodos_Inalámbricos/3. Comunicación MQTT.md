Funcionamiento de MQTT
-
MQTT (Message Queuing Telemetry Transport) es un protocolo de mensajería ligero y eficiente diseñado para la comunicación entre dispositivos en redes con ancho de banda limitado o conexiones inestables. Se basa en un modelo publicador-suscriptor, donde los dispositivos pueden actuar como publicadores (enviando mensajes) o suscriptores (recibiéndolos).

El broker es el intermediario encargado de gestionar la comunicación entre los dispositivos. Su función es recibir los mensajes de los publicadores y distribuirlos a los suscriptores que estén interesados en un determinado tema o canal de comunicación. Esto permite una comunicación flexible, eficiente y escalable en aplicaciones de IoT, automatización y más.

 Broker MQTT
 -
 En este proyecto, utilizamos EMQX como broker MQTT, el cual se instala en la máquina local para gestionar la comunicación entre los dispositivos publicadores y 
 suscriptores.

 Instalación y Configuración
 -
 1. Descargar e instalar EMQX en la máquina local desde su sitio oficial: https://www.emqx.com/en.
 2. Configurar el puerto en 1883, que es el puerto predeterminado para MQTT.
 3. Verificar que el broker esté en funcionamiento, accediendo a localhost:1883 o revisando los logs del servicio.

 Prueba con Mosquitto
 -
 Para comprobar el funcionamiento del broker, podemos utilizar Mosquitto, un cliente MQTT que permite publicar y suscribirse a temas. Esto se hace con los siguientes comandos: 
   ```
mosquitto_sub -h localhost -p 1883 -t "prueba/mqtt"
```
  ```
mosquitto_pub -h localhost -p 1883 -t "prueba/mqtt" -m "Mensaje de prueba"
```
Si funcionó de manera correcta se debería ver de la siguiente manera:
<img src="/Nodos_Inalámbricos/imgs/pruebaMosquitto.png" width="900px">

Cliente MQTT - NODE-RED 
-
Node-RED es una herramienta de programación visual basada en flujos diseñada para conectar dispositivos, APIs y servicios en aplicaciones de IoT. Se basa en nodos que representan funciones específicas y pueden conectarse entre sí mediante flujos de datos. En este proyecto, utilizamos Node-RED para gestionar y visualizar los datos provenientes del sensor EMG, el IMU en la muñeca y el IMU en el antebrazo. 

Es importante realizar la instalacion de node-red siguiendo este tutorial para linux: https://nodered.org/docs/getting-started/local o este para windows: https://www.youtube.com/watch?v=zEPn5-m0zTw

Una vez todo lo anterior este funcionando abrimos un nuevo flujo en node-red, buscamos la opcion que diga exportar y pegamos el siguiente codigo:

  ```
[
    {
        "id": "94f57d35bb1b70bc",
        "type": "tab",
        "label": "EMG_TOMA",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "8036208e9c185eef",
        "type": "mqtt in",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "topic": "/N1/EMG/data",
        "qos": "1",
        "datatype": "auto-detect",
        "broker": "9feb18610cd75adc",
        "nl": false,
        "rap": true,
        "rh": "2",
        "inputs": 0,
        "x": 90,
        "y": 600,
        "wires": [
            [
                "906f4bc0e3635277",
                "5f34ea4bd656c517",
                "1d08f70750298931",
                "ec8ce8504cd355b2"
            ]
        ]
    },
    {
        "id": "36eb6bad0bdf3e05",
        "type": "ui_chart",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "group": "caecf63d5e0219ee",
        "order": 2,
        "width": 0,
        "height": 0,
        "label": "Datos Escalados EMG",
        "chartType": "line",
        "legend": "false",
        "xformat": "auto",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "0",
        "ymax": "100",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "3600",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "tamanochart",
        "x": 880,
        "y": 600,
        "wires": [
            []
        ]
    },
    {
        "id": "c6f14c914d3b4450",
        "type": "function",
        "z": "94f57d35bb1b70bc",
        "name": "Calculate Time",
        "func": "var timerActive = flow.get('timerActive');\nvar startTime = flow.get('startTime');\nvar msg2 = { payload: \"0\" };\n\nif (timerActive && startTime) {\n    var now = new Date().getTime();\n    var elapsed = now - startTime;\n    var totalSeconds = Math.floor(elapsed / 1000);\n    var minutes = Math.floor(totalSeconds / 60);\n    var seconds = totalSeconds % 60;\n\n    // Format minutes and seconds to two digits\n    var formattedTime = (minutes < 10 ? '0' : '') + minutes + ':' + (seconds < 10 ? '0' : '') + seconds;\n    flow.set('lastFormattedTime', formattedTime);\n    \n    msg.payload = formattedTime; \n    \n    var mensajes_esperados_counter = flow.get('mensajes_esperados');\n    var lastIncrementTime = flow.get('lastIncrementTime');\n    \n    // Increment the counter every 2 seconds\n    if (totalSeconds >= lastIncrementTime + 1) {\n        mensajes_esperados_counter = Math.round(totalSeconds/2);\n        flow.set('mensajes_esperados', mensajes_esperados_counter);\n        flow.set('lastIncrementTime', totalSeconds);\n    }\n    msg2.payload = flow.get('mensajes_esperados');\n\n} \nelse {\n    msg.payload = flow.get('lastFormattedTime');\n    msg2.payload = flow.get('mensajes_esperados');\n}\nreturn [msg, msg2];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\nflow.set('timerActive', false);\nflow.set('startTime');\nflow.set('lastFormattedTime', \"00:00\");\nflow.set('lastIncrementTime', 0);\nflow.set('mensajes_esperados',0);\n",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 360,
        "wires": [
            [
                "35dd635e3e5d61e2"
            ],
            [
                "a0d75307306b6260"
            ]
        ]
    },
    {
        "id": "35dd635e3e5d61e2",
        "type": "ui_text",
        "z": "94f57d35bb1b70bc",
        "group": "a1471ef42c395f43",
        "order": 8,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Tiempo transcurrido:",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": "",
        "color": "#000000",
        "x": 720,
        "y": 360,
        "wires": []
    },
    {
        "id": "a2b94f2c51aaa512",
        "type": "inject",
        "z": "94f57d35bb1b70bc",
        "name": "Update Timer",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "0.5",
        "crontab": "",
        "once": false,
        "onceDelay": "0.0",
        "topic": "",
        "payload": "",
        "payloadType": "str",
        "x": 120,
        "y": 360,
        "wires": [
            [
                "c6f14c914d3b4450"
            ]
        ]
    },
    {
        "id": "771576717126d140",
        "type": "function",
        "z": "94f57d35bb1b70bc",
        "name": "Modificar Estado del Botón",
        "func": "// Establecer la nueva etiqueta y color del botón en función del estado\nif (flow.get('timerActive')) {\n    msg.payload = {\n        label: \"Detener\",\n        color: \"#FF0000\" // Rojo\n    };\n} else {\n    msg.payload = {\n        label: \"Iniciar\",\n        color: \"#007300\" // Verde\n    };\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 260,
        "wires": [
            [
                "ae1b556a1ea53ec5"
            ]
        ]
    },
    {
        "id": "ce872336b440eaae",
        "type": "function",
        "z": "94f57d35bb1b70bc",
        "name": "Activar cronómetro",
        "func": "if (msg.payload === 'start') {\n    flow.set('timerActive', true);\n    flow.set('startTime', new Date().getTime());\n    flow.set('lastIncrementTime', 0);\n    flow.set('mensajes_esperados', 0);\n    global.set(\"contador_mensajes_N1\",0);\n    global.set(\"contador_mensajes_N1_EMG1\", 0);\n    \n} else if (msg.payload === 'stop') {\n    flow.set('timerActive', false);\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1410,
        "y": 260,
        "wires": [
            [
                "771576717126d140"
            ]
        ]
    },
    {
        "id": "ba5d4b4e37766a81",
        "type": "change",
        "z": "94f57d35bb1b70bc",
        "name": "START",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "start",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 940,
        "y": 220,
        "wires": [
            [
                "1115bdf20d310c15",
                "94f4535d0e631543",
                "4d0bd95b3c5cdc1f",
                "6e3aad22ddb57806",
                "cf88d52965ea5275"
            ]
        ]
    },
    {
        "id": "0d7358f1fdc8ba75",
        "type": "change",
        "z": "94f57d35bb1b70bc",
        "name": "STOP",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "stop",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 930,
        "y": 300,
        "wires": [
            [
                "ce872336b440eaae",
                "b60dfca5bdee15cd",
                "b6009e4f4b707433",
                "03501256353f719f"
            ]
        ]
    },
    {
        "id": "e03320008554fe15",
        "type": "inject",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "0.2",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 110,
        "y": 260,
        "wires": [
            [
                "771576717126d140",
                "3c7faf8f226968ba"
            ]
        ]
    },
    {
        "id": "ae1b556a1ea53ec5",
        "type": "ui_button",
        "z": "94f57d35bb1b70bc",
        "name": "Botón de Cambio",
        "group": "a1471ef42c395f43",
        "order": 6,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "{{msg.payload.label}}",
        "tooltip": "",
        "color": "",
        "bgcolor": "{{msg.payload.color}}",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "",
        "topicType": "str",
        "x": 590,
        "y": 260,
        "wires": [
            [
                "ab2a5ab3f9f54829"
            ]
        ]
    },
    {
        "id": "76fc0bc3bb389427",
        "type": "ui_template",
        "z": "94f57d35bb1b70bc",
        "group": "caecf63d5e0219ee",
        "name": "",
        "order": 1,
        "width": 0,
        "height": 0,
        "format": "<style>\n    .nr-dashboard-button {\n        padding-left: 10px !important;\n        padding-right: 10px !important;\n    }\n\n    .md-button {\n        padding-left: 10px !important;\n        padding-right: 10px !important;\n    }\n\n    .md-input {\n        margin-top: 10px !important;\n    }\n\n    .tamanogrupochart .nr-dashboard-cardcontainer{\n        height: 966px !important;\n    \n    }\n    .tamanochart {\n        height: 930px !important;\n\n    }\n    \n\n\n\n</style>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "global",
        "className": "",
        "x": 80,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "b60dfca5bdee15cd",
        "type": "mqtt out",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "topic": "/start/cmd",
        "qos": "1",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "9feb18610cd75adc",
        "x": 1440,
        "y": 200,
        "wires": []
    },
    {
        "id": "38766cd5c072a0f8",
        "type": "ui_text_input",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "label": "Nombre:",
        "tooltip": "",
        "group": "a1471ef42c395f43",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "text",
        "delay": 300,
        "topic": "topic",
        "sendOnBlur": true,
        "className": "",
        "topicType": "msg",
        "x": 1760,
        "y": 880,
        "wires": [
            [
                "083e7308223bd503"
            ]
        ]
    },
    {
        "id": "64973cb22b863ece",
        "type": "ui_text_input",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "label": "Edad:",
        "tooltip": "",
        "group": "a1471ef42c395f43",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "number",
        "delay": 300,
        "topic": "topic",
        "sendOnBlur": true,
        "className": "",
        "topicType": "msg",
        "x": 1750,
        "y": 920,
        "wires": [
            [
                "682d0853ef1d0614"
            ]
        ]
    },
    {
        "id": "b922d070bb4ceaa3",
        "type": "ui_text_input",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "label": "Músculo:",
        "tooltip": "",
        "group": "a1471ef42c395f43",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "text",
        "delay": 300,
        "topic": "topic",
        "sendOnBlur": true,
        "className": "",
        "topicType": "msg",
        "x": 1760,
        "y": 960,
        "wires": [
            [
                "5767a33a65be7df7"
            ]
        ]
    },
    {
        "id": "ab2a5ab3f9f54829",
        "type": "function",
        "z": "94f57d35bb1b70bc",
        "name": "switch",
        "func": "let timer = flow.get(\"timerActive\")\nlet msg1\n\nmsg1 = { payload: timer }\n\nif (timer){\n\n    return [null, msg1]\n\n} else {\n\n    return [msg1, null]\n}\n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 260,
        "wires": [
            [
                "ba5d4b4e37766a81"
            ],
            [
                "0d7358f1fdc8ba75"
            ]
        ]
    },
    {
        "id": "2fa25b8cbf9eda0b",
        "type": "file",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "filename": "filename",
        "filenameType": "msg",
        "appendNewline": false,
        "createDir": false,
        "overwriteFile": "false",
        "encoding": "none",
        "x": 640,
        "y": 640,
        "wires": [
            []
        ]
    },
    {
        "id": "5f34ea4bd656c517",
        "type": "function",
        "z": "94f57d35bb1b70bc",
        "name": "Guardar Escalados TXT N1 EMG",
        "func": "let calibracion = global.get(\"calibracion\")\nlet limitemin = global.get(\"limiteminEMG\");\nlet limitemax = global.get(\"limitemaxEMG\");\n\n// Función para mapear el valor\nfunction mapRange(value, fromMin, fromMax, toMin, toMax) {\n\n    let mapdata = toMin + ((value - fromMin) * (toMax - toMin)) / (fromMax - fromMin);\n\n    if (mapdata < 0.0){    \n        mapdata = 0.0\n    }\n\n    return parseFloat(mapdata.toFixed(2));\n}\n\n\nif (!(calibracion)) {\n\n    var path = global.get('folder_path');\n        \n    msg.filename = path + `/EMG.txt`;\n\n    var datos = msg.payload.data;\n    const indice = msg.payload.index;\n    var n = (indice * datos.length) + 1;\n    var texto = \"\";\n\n\n    for (let index = 0; index < datos.length; index++) {\n\n        let datamap = mapRange(datos[index], limitemin, limitemax, 0, 100);\n\n        texto = texto + n + \",\" + datamap + \"\\n\";\n        n = n + 1;\n    }\n    msg.payload = texto;\n    return msg;\n\n}else{\n\n    return null;\n\n}\n\n\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 640,
        "wires": [
            [
                "2fa25b8cbf9eda0b"
            ]
        ]
    },
    {
        "id": "a0d75307306b6260",
        "type": "ui_text",
        "z": "94f57d35bb1b70bc",
        "group": "43eefe2eef3aec0e",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Mensajes Esperados",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": 16,
        "color": "#000000",
        "x": 700,
        "y": 420,
        "wires": []
    },
    {
        "id": "e50c61fdaf9b7ffa",
        "type": "mqtt out",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "topic": "/path",
        "qos": "1",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "9feb18610cd75adc",
        "x": 2030,
        "y": 60,
        "wires": []
    },
    {
        "id": "e054395875be80d2",
        "type": "mqtt in",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "topic": "/images/count",
        "qos": "1",
        "datatype": "auto-detect",
        "broker": "9feb18610cd75adc",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 90,
        "y": 1200,
        "wires": [
            [
                "4018b352bb44a9e3"
            ]
        ]
    },
    {
        "id": "338e6ffbc21e08d6",
        "type": "ui_toast",
        "z": "94f57d35bb1b70bc",
        "position": "bottom right",
        "displayTime": "5",
        "highlight": "",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "",
        "name": "Inicio en 3s",
        "x": 1450,
        "y": 160,
        "wires": []
    },
    {
        "id": "1115bdf20d310c15",
        "type": "delay",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "pauseType": "delay",
        "timeout": "3",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1240,
        "y": 200,
        "wires": [
            [
                "b60dfca5bdee15cd",
                "ce872336b440eaae",
                "6b5095f5c9e527f2"
            ]
        ]
    },
    {
        "id": "94f4535d0e631543",
        "type": "change",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "La toma de datos iniciará en 3 segundos",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1240,
        "y": 160,
        "wires": [
            [
                "338e6ffbc21e08d6"
            ]
        ]
    },
    {
        "id": "ec62767d36ff240c",
        "type": "exec",
        "z": "94f57d35bb1b70bc",
        "command": "sudo /home/investigacion/Documents/NODO_CAMARA_CPP/capture_images ",
        "addpay": "",
        "append": "",
        "useSpawn": "true",
        "timer": "",
        "winHide": false,
        "oldrc": false,
        "name": "Inicia nodo de la Cámara",
        "x": 1870,
        "y": 360,
        "wires": [
            [
                "4f921194d5af0dd0"
            ],
            [],
            []
        ]
    },
    {
        "id": "82a58663fde0055e",
        "type": "ui_text_input",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "label": "Nombre del Estudio:",
        "tooltip": "",
        "group": "a1471ef42c395f43",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "text",
        "delay": 300,
        "topic": "topic",
        "sendOnBlur": true,
        "className": "",
        "topicType": "msg",
        "x": 1800,
        "y": 1000,
        "wires": [
            [
                "46f6d548be458a14"
            ]
        ]
    },
    {
        "id": "9c7e7a33f4685e57",
        "type": "change",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "kill",
                "pt": "msg",
                "to": "SIGKILL",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1410,
        "y": 360,
        "wires": [
            [
                "ec62767d36ff240c"
            ]
        ]
    },
    {
        "id": "exec-node",
        "type": "exec",
        "z": "94f57d35bb1b70bc",
        "command": "",
        "addpay": "payload",
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "winHide": false,
        "oldrc": false,
        "name": "Execute mkdir",
        "x": 1460,
        "y": 100,
        "wires": [
            [
                "7a0a69b2b85baccf"
            ],
            [],
            []
        ]
    },
    {
        "id": "083e7308223bd503",
        "type": "change",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "paciente_name",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2030,
        "y": 880,
        "wires": [
            []
        ]
    },
    {
        "id": "682d0853ef1d0614",
        "type": "change",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "paciente_edad",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2030,
        "y": 920,
        "wires": [
            []
        ]
    },
    {
        "id": "5767a33a65be7df7",
        "type": "change",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "paciente_articulacion",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2050,
        "y": 960,
        "wires": [
            []
        ]
    },
    {
        "id": "46f6d548be458a14",
        "type": "change",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "paciente_nombre_estudio",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2070,
        "y": 1000,
        "wires": [
            []
        ]
    },
    {
        "id": "4d0bd95b3c5cdc1f",
        "type": "function",
        "z": "94f57d35bb1b70bc",
        "name": "Create Command",
        "func": "// Obtener el nombre del paciente desde la variable global\nlet calibracion = global.get(\"calibracion\")\n\nif (!(calibracion)) {\n\n    var folderNamePrefix = global.get('paciente_name');\n\n    // Convertir el string a minúsculas\n    folderNamePrefix = folderNamePrefix.toLowerCase();\n    // Reemplazar los espacios por guiones bajos\n    folderNamePrefix = folderNamePrefix.replace(/\\s+/g, '_');\n\n    // Obtener la fecha y hora actuales\n    var now = new Date();\n    var year = now.getFullYear();\n    var month = ('0' + (now.getMonth() + 1)).slice(-2);\n    var day = ('0' + now.getDate()).slice(-2);\n    var hours = ('0' + now.getHours()).slice(-2);\n    var minutes = ('0' + now.getMinutes()).slice(-2);\n\n    // Formatear la fecha y hora como YYYYMMDD_HHMM\n    var formattedDate = `${year}${month}${day}_${hours}${minutes}`;\n\n    // Construir el nombre completo del folder\n    var folderPath = `/home/investigacion/Documents/EXAMENES_TEST/${formattedDate}_${folderNamePrefix}`;\n\n    global.set('folder_path', folderPath);\n\n    // Construir el comando mkdir\n    msg.payload = `mkdir -p ${folderPath}`;\n\n    //Reinicia la bandera de reset\n    global.set(\"reiniciar_contenedores\", false);\n\n    return msg;\n\n}else{\n\n    return null;\n\n}\n\n\n\n\n\n\n\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\nglobal.set('folder_path', \"\");",
        "finalize": "",
        "libs": [],
        "x": 1250,
        "y": 40,
        "wires": [
            [
                "exec-node"
            ]
        ]
    },
    {
        "id": "4cacda3a8595ee11",
        "type": "inject",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 680,
        "y": 160,
        "wires": [
            [
                "0d7358f1fdc8ba75"
            ]
        ]
    },
    {
        "id": "7a0a69b2b85baccf",
        "type": "change",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "folder_path",
                "tot": "global"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1680,
        "y": 40,
        "wires": [
            [
                "78c3650d48547862"
            ]
        ]
    },
    {
        "id": "b6009e4f4b707433",
        "type": "delay",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1220,
        "y": 360,
        "wires": [
            [
                "9c7e7a33f4685e57"
            ]
        ]
    },
    {
        "id": "4018b352bb44a9e3",
        "type": "ui_text",
        "z": "94f57d35bb1b70bc",
        "group": "43eefe2eef3aec0e",
        "order": 4,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Lote de fotos almacenados",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": 16,
        "color": "#000000",
        "x": 680,
        "y": 1200,
        "wires": []
    },
    {
        "id": "3c7faf8f226968ba",
        "type": "change",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "0",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 460,
        "y": 480,
        "wires": [
            [
                "a0d75307306b6260",
                "4018b352bb44a9e3",
                "a25a1c5f4eba1b45",
                "5bb3d29e53f950a7"
            ]
        ]
    },
    {
        "id": "6e3aad22ddb57806",
        "type": "link out",
        "z": "94f57d35bb1b70bc",
        "name": "link out 1",
        "mode": "link",
        "links": [
            "b42ffe116dab3afc",
            "8ca0a11dccb3290b"
        ],
        "x": 1145,
        "y": 420,
        "wires": []
    },
    {
        "id": "b42ffe116dab3afc",
        "type": "link in",
        "z": "94f57d35bb1b70bc",
        "name": "link in 1",
        "links": [
            "6e3aad22ddb57806"
        ],
        "x": 325,
        "y": 480,
        "wires": [
            [
                "3c7faf8f226968ba"
            ]
        ]
    },
    {
        "id": "db3cd2f2497c8ba7",
        "type": "ui_text",
        "z": "94f57d35bb1b70bc",
        "group": "6b9ae3dc211019f4",
        "order": 4,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Valor maximo EMG",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": 16,
        "color": "#000000",
        "x": 1810,
        "y": 580,
        "wires": []
    },
    {
        "id": "5e62430650e13eea",
        "type": "ui_switch",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "label": "Activar Calibración",
        "tooltip": "",
        "group": "6b9ae3dc211019f4",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "topic",
        "topicType": "msg",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "animate": true,
        "className": "",
        "x": 1130,
        "y": 600,
        "wires": [
            [
                "8b3f18ee39acfdd5"
            ]
        ]
    },
    {
        "id": "8b3f18ee39acfdd5",
        "type": "function",
        "z": "94f57d35bb1b70bc",
        "name": "guarda calibracion",
        "func": "global.set(\"calibracion\",msg.payload)\nlet msg1\n\nif (msg.payload){\n\n    msg.enabled = true \n    msg1 = { enabled: false } \n\n}else {\n\n    msg.enabled = false\n    msg1 = { enabled: true } \n}\n\nreturn [msg, msg1];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1350,
        "y": 600,
        "wires": [
            [
                "ce232a3c9bebb7d5",
                "cf7079a70a00d955"
            ],
            [
                "d3d5c1486a589fd0"
            ]
        ]
    },
    {
        "id": "2b75734c87f7f226",
        "type": "inject",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "false",
        "payloadType": "bool",
        "x": 950,
        "y": 520,
        "wires": [
            [
                "5e62430650e13eea"
            ]
        ]
    },
    {
        "id": "ce232a3c9bebb7d5",
        "type": "change",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "0",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1560,
        "y": 580,
        "wires": [
            [
                "db3cd2f2497c8ba7",
                "e87d635b6de5346d"
            ]
        ]
    },
    {
        "id": "0dc16ba9bf3c8242",
        "type": "function",
        "z": "94f57d35bb1b70bc",
        "name": "calcular maximos",
        "func": "let calibracion = global.get(\"calibracion\")\n\nif(calibracion){\n    // Obtener los datos del mensaje\n    var datos = msg.payload.data;\n    const indice = msg.payload.index;\n    var n = (indice * datos.length) + 1;\n\n    // Obtener el historial de datos EMG y sus índices\n    var dataArray = global.get(\"historicoEMGcalibracion\") || [];\n    var maximosArray = [];\n\n    const tamanoBloque = 300; // Tamaño de cada bloque\n    const maxHistorial = 100; // Número máximo de bloques (para limitar el tamaño de maximosArray)\n\n    // Agregar nuevos datos al historial\n    for (let i = 0; i < datos.length; i++) {\n        dataArray.push(datos[i]);\n        // Si el historial excede el tamaño del bloque, eliminar los datos más antiguos\n        if (dataArray.length > tamanoBloque * (maxHistorial - 1)) {\n            dataArray.shift();\n        }\n    }\n\n    // Función para calcular el valor máximo de un bloque\n    function calcularMaximo(data) {\n        return data.length ? Math.max(...data) : 0;\n    }\n\n    // Procesar los datos en bloques y calcular los máximos\n    function procesarDatosEnBloques(dataArray, tamanoBloque) {\n        var maximos = [];\n        for (let i = 0; i < dataArray.length; i += tamanoBloque) {\n            let bloque = dataArray.slice(i, i + tamanoBloque);\n            let maximoBloque = calcularMaximo(bloque);\n            maximos.push(maximoBloque);\n        }\n        return maximos;\n    }\n\n    // Calcular los valores máximos de los bloques\n    var maximosBloques = procesarDatosEnBloques(dataArray, tamanoBloque);\n\n    // Mantener solo los últimos maxHistorial valores máximos\n    if (maximosArray.length >= maxHistorial) {\n        maximosArray.shift(); // Eliminar el valor más antiguo\n    }\n    maximosArray = maximosArray.concat(maximosBloques);\n\n    // Guardar el historial actualizado y los valores máximos\n    global.set(\"historicoEMGcalibracion\", dataArray);\n\n\n\n    var maxMaximos = calcularMaximo(maximosArray);\n\n    var maxMaximosround = parseFloat(maxMaximos.toFixed(2));\n\n    global.set(\"maxMaximosround\", maxMaximosround);\n\n    return msg = { payload: maxMaximosround };\n\n}else{\n\n    return null;\n\n}\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\nglobal.set(\"historicoEMGcalibracion\", []);",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 740,
        "wires": [
            [
                "3dce9330bbd73c2e"
            ]
        ]
    },
    {
        "id": "d3d5c1486a589fd0",
        "type": "change",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "rules": [
            {
                "t": "delete",
                "p": "payload",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1550,
        "y": 840,
        "wires": [
            [
                "38766cd5c072a0f8",
                "64973cb22b863ece",
                "b922d070bb4ceaa3",
                "82a58663fde0055e"
            ]
        ]
    },
    {
        "id": "3dce9330bbd73c2e",
        "type": "link out",
        "z": "94f57d35bb1b70bc",
        "name": "link out 2",
        "mode": "link",
        "links": [
            "079e0dcfe31aa86e",
            "e4493e88641e9847",
            "515de2cfff21b4a9"
        ],
        "x": 585,
        "y": 740,
        "wires": []
    },
    {
        "id": "079e0dcfe31aa86e",
        "type": "link in",
        "z": "94f57d35bb1b70bc",
        "name": "link in 2",
        "links": [
            "3dce9330bbd73c2e",
            "63f8769055919557"
        ],
        "x": 1645,
        "y": 500,
        "wires": [
            [
                "db3cd2f2497c8ba7"
            ]
        ]
    },
    {
        "id": "db1eb814e7c1e5b4",
        "type": "ui_dropdown",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "label": "Nivel de Fuerza",
        "tooltip": "",
        "place": "Seleccione",
        "group": "6b9ae3dc211019f4",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "Mínima",
                "value": 1,
                "type": "num"
            },
            {
                "label": "Máxima",
                "value": 2,
                "type": "num"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 1800,
        "y": 640,
        "wires": [
            [
                "2582aded64e1bf28"
            ]
        ]
    },
    {
        "id": "2582aded64e1bf28",
        "type": "function",
        "z": "94f57d35bb1b70bc",
        "name": "guarda fuerza",
        "func": "global.set(\"fuerza\",msg.payload)\n\nreturn null;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2020,
        "y": 640,
        "wires": [
            []
        ]
    },
    {
        "id": "bb7a2d29b8b7b38a",
        "type": "function",
        "z": "94f57d35bb1b70bc",
        "name": "establecer limites",
        "func": "let calibracion = global.get(\"calibracion\")\nlet fuerza = global.get(\"fuerza\")\nlet canal = global.get(\"canal\")\nlet maxMaximosround = global.get(\"maxMaximosround\")\n\n\nif(calibracion){\n\n    if (fuerza === 1 && canal === 1) {\n\n        global.set(\"limiteminEMG\", maxMaximosround)\n\n    } else if (fuerza === 1 && canal === 2){\n\n        global.set(\"limiteminEMG1\", maxMaximosround)\n\n    } else if (fuerza === 2 && canal === 1) {\n\n        global.set(\"limitemaxEMG\", maxMaximosround)\n    \n    }else{\n\n        global.set(\"limitemaxEMG1\", maxMaximosround)\n\n    }\n\n\n\n\n} else {\n\n    return null;\n\n}\n\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 810,
        "y": 760,
        "wires": [
            []
        ]
    },
    {
        "id": "e4493e88641e9847",
        "type": "link in",
        "z": "94f57d35bb1b70bc",
        "name": "link in 3",
        "links": [
            "3dce9330bbd73c2e",
            "d7533aba4c107f3b"
        ],
        "x": 655,
        "y": 760,
        "wires": [
            [
                "bb7a2d29b8b7b38a"
            ]
        ]
    },
    {
        "id": "906f4bc0e3635277",
        "type": "function",
        "z": "94f57d35bb1b70bc",
        "name": "Extraer datos EMG",
        "func": "var datos = msg.payload.data;\nconst indice = msg.payload.index; // Aquí está el índice de la serie\nvar n = (indice * datos.length) + 1;\n\n// Obtener el historial de datos EMG y sus índices\nvar dataArray = global.get(\"historicoEMG\") || [];\nvar labelArray = global.get(\"historicoEMG_index\") || [];\nconst maxHistorial = 300; // Máxima cantidad de puntos en el historial\n\n// Función para actualizar el gráfico en bloques de 10 datos con ventana deslizante\nfunction actualizarGrafico(index) {\n    if (index < datos.length) {\n        for (let i = 0; i < 10 && index < datos.length; i++, index++) {\n            // Agregar el nuevo punto al historial\n            dataArray.push(datos[index]);\n            labelArray.push(n);\n            n++;\n\n            // Si el historial excede el máximo permitido, eliminar el primer punto\n            if (dataArray.length > maxHistorial) {\n                dataArray.shift();\n                labelArray.shift();\n            }\n        }\n\n        // Construir el objeto de datos para el nodo Chart\n        var chartData = [{\n            \"series\": [\"EMG\"],\n            \"data\": [dataArray.slice()], // Copiar el array para evitar problemas de referencia\n            \"labels\": labelArray.slice()\n        }];\n\n        var msgClone = RED.util.cloneMessage(msg);\n        msgClone.payload = chartData;\n\n        node.send(msgClone);  // Enviar los datos al gráfico\n\n        // Llamar a la función nuevamente después de 200 ms para el siguiente bloque\n        setTimeout(() => actualizarGrafico(index), 200);\n    }\n}\n\n// Iniciar la actualización del gráfico\nactualizarGrafico(0);\n\n// Guardar el historial actualizado en variables globales\nglobal.set(\"historicoEMG\", dataArray);\nglobal.set(\"historicoEMG_index\", labelArray);\n\nreturn null;  // No es necesario devolver msg ya que se ha enviado dentro del bucle\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\n\nglobal.set(\"historicoEMG\", []);\nglobal.set(\"historicoEMG_index\", []);",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 600,
        "wires": [
            [
                "94f388e4567597a7",
                "5da6602b137749e2"
            ]
        ]
    },
    {
        "id": "94f388e4567597a7",
        "type": "function",
        "z": "94f57d35bb1b70bc",
        "name": "escalar",
        "func": "// Obtener los límites de mapeo desde las variables globales\nlet limitemin = global.get(\"limiteminEMG\");\nlet limitemax = global.get(\"limitemaxEMG\");\n\n// Función para mapear el valor\nfunction mapRange(value, fromMin, fromMax, toMin, toMax) {\n    return toMin + ((value - fromMin) * (toMax - toMin)) / (fromMax - fromMin);\n}\n\n// Mapeo de cada valor en la serie de datos\nmsg.payload.forEach(seriesObj => {\n    seriesObj.data = seriesObj.data.map(dataArray =>\n        dataArray.map(value => {\n            let mappedValue = mapRange(value, limitemin, limitemax, 0, 100);\n            // Si el valor mapeado es menor que 0, se establece en 0\n            mappedValue < 0 ? 0 : mappedValue;\n            return parseFloat(mappedValue.toFixed(2));\n        })\n    );\n});\n// Devolver el mensaje con los datos mapeados\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 640,
        "y": 600,
        "wires": [
            [
                "36eb6bad0bdf3e05"
            ]
        ]
    },
    {
        "id": "5da6602b137749e2",
        "type": "ui_chart",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "group": "caecf63d5e0219ee",
        "order": 11,
        "width": 0,
        "height": 0,
        "label": "Datos Directos EMG ",
        "chartType": "line",
        "legend": "false",
        "xformat": "auto",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "",
        "ymax": "",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "3600",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "",
        "x": 700,
        "y": 540,
        "wires": [
            []
        ]
    },
    {
        "id": "78c3650d48547862",
        "type": "delay",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1860,
        "y": 60,
        "wires": [
            [
                "e50c61fdaf9b7ffa"
            ]
        ]
    },
    {
        "id": "4f921194d5af0dd0",
        "type": "debug",
        "z": "94f57d35bb1b70bc",
        "name": "debug 1",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2080,
        "y": 300,
        "wires": []
    },
    {
        "id": "cf88d52965ea5275",
        "type": "function",
        "z": "94f57d35bb1b70bc",
        "name": "guarda imagenes",
        "func": "let calibracion = global.get(\"calibracion\")\n\nif(calibracion){\n\n    return null;\n\n}else{\n\n    return msg;\n\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1630,
        "y": 320,
        "wires": [
            [
                "ec62767d36ff240c"
            ]
        ]
    },
    {
        "id": "cf7079a70a00d955",
        "type": "change",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "1",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1580,
        "y": 640,
        "wires": [
            [
                "db1eb814e7c1e5b4",
                "d1a53d29cb5d3550"
            ]
        ]
    },
    {
        "id": "959b6bde52370aa4",
        "type": "file",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "filename": "filename",
        "filenameType": "msg",
        "appendNewline": false,
        "createDir": false,
        "overwriteFile": "false",
        "encoding": "none",
        "x": 680,
        "y": 1400,
        "wires": [
            []
        ]
    },
    {
        "id": "212701a8e79d07d6",
        "type": "function",
        "z": "94f57d35bb1b70bc",
        "name": "Guardar IMU TXT N8",
        "func": "//var d = new Date();\n//var t = d.getTime();\n//var year = d.getFullYear();\n//var month = d.getMonth() + 1;\n//var day = d.getDate();\n//var hour = d.getHours();\n//msg.date = t;\n//msg.filename = \"/home/investigacion/Desktop/\" + year + \"_\" + month + \"_\" + day + \".txt\";\n//msg.payload = \"HOLA SERGIO\"\nmsg.filename = \"/home/investigacion/Desktop/\"+\"N8_IMU\"+\".txt\";\n\nif (global.get(\"primera_vez_N8\")){\n    global.set(\"primer_tiempo_N8\", msg.payload.t0);\n    global.set(\"primera_vez_N8\", false);\n}\n\nconst ax = msg.payload.ax;\nconst ay = msg.payload.ay;\nconst az = msg.payload.az;\nconst gx = msg.payload.gx;\nconst gy = msg.payload.gy;\nconst gz = msg.payload.gz;\n\nvar texto = \"\";\nfor (let index = 0; index < ax.length; index++) {\n    texto = texto + ax[index] + \",\" + ay[index] + \",\" + az[index] + \",\" + gx[index] + \",\" + gy[index] + \",\" + gz[index] + \"\\n\";\n}\n\nmsg.payload = texto;\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\nglobal.set(\"primer_tiempo_N8\", 0);\nglobal.set(\"primera_vez_N8\",true);",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 1400,
        "wires": [
            [
                "959b6bde52370aa4"
            ]
        ]
    },
    {
        "id": "3101643aeafb067c",
        "type": "mqtt in",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "topic": "/ESP32_N8/data",
        "qos": "1",
        "datatype": "auto-detect",
        "broker": "9feb18610cd75adc",
        "nl": false,
        "rap": true,
        "rh": "2",
        "inputs": 0,
        "x": 100,
        "y": 1400,
        "wires": [
            [
                "212701a8e79d07d6",
                "aaf581c3f220bc6f"
            ]
        ]
    },
    {
        "id": "b0ccdca24dfbe3a5",
        "type": "mqtt in",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "topic": "/ESP32_N7/data",
        "qos": "1",
        "datatype": "auto-detect",
        "broker": "9feb18610cd75adc",
        "nl": false,
        "rap": true,
        "rh": "2",
        "inputs": 0,
        "x": 100,
        "y": 1500,
        "wires": [
            [
                "bdcafed5622e6f71",
                "fa9b4b4c104ba108"
            ]
        ]
    },
    {
        "id": "bdcafed5622e6f71",
        "type": "function",
        "z": "94f57d35bb1b70bc",
        "name": "Guardar IMU TXT N7",
        "func": "//var d = new Date();\n//var t = d.getTime();\n//var year = d.getFullYear();\n//var month = d.getMonth() + 1;\n//var day = d.getDate();\n//var hour = d.getHours();\n//msg.date = t;\n//msg.filename = \"/home/investigacion/Desktop/\" + year + \"_\" + month + \"_\" + day + \".txt\";\n//msg.payload = \"HOLA SERGIO\"\nmsg.filename = \"/home/investigacion/Desktop/\"+\"N7_IMU\"+\".txt\";\n\nif (global.get(\"primera_vez_N7\")){\n    global.set(\"primer_tiempo_N7\", msg.payload.t0);\n    global.set(\"primera_vez_N7\", false);\n}\n\nconst ax = msg.payload.ax;\nconst ay = msg.payload.ay;\nconst az = msg.payload.az;\nconst gx = msg.payload.gx;\nconst gy = msg.payload.gy;\nconst gz = msg.payload.gz;\n\nvar texto = \"\";\nfor (let index = 0; index < ax.length; index++) {\n    texto = texto + ax[index] + \",\" + ay[index] + \",\" + az[index] + \",\" + gx[index] + \",\" + gy[index] + \",\" + gz[index] + \"\\n\";\n}\n\nmsg.payload = texto;\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\nglobal.set(\"primer_tiempo_N7\", 0);\nglobal.set(\"primera_vez_N7\",true);",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 1500,
        "wires": [
            [
                "337d4ed2be4e8c29"
            ]
        ]
    },
    {
        "id": "337d4ed2be4e8c29",
        "type": "file",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "filename": "filename",
        "filenameType": "msg",
        "appendNewline": false,
        "createDir": false,
        "overwriteFile": "false",
        "encoding": "none",
        "x": 680,
        "y": 1500,
        "wires": [
            []
        ]
    },
    {
        "id": "fb99332f155d6504",
        "type": "mqtt out",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "topic": "/ESP32/cmd",
        "qos": "0",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "9feb18610cd75adc",
        "x": 1950,
        "y": 200,
        "wires": []
    },
    {
        "id": "03501256353f719f",
        "type": "link out",
        "z": "94f57d35bb1b70bc",
        "name": "link out 4",
        "mode": "link",
        "links": [
            "4393c1bd67f4020b"
        ],
        "x": 1025,
        "y": 380,
        "wires": []
    },
    {
        "id": "4393c1bd67f4020b",
        "type": "link in",
        "z": "94f57d35bb1b70bc",
        "name": "link in 5",
        "links": [
            "03501256353f719f"
        ],
        "x": 1805,
        "y": 240,
        "wires": [
            [
                "fb99332f155d6504"
            ]
        ]
    },
    {
        "id": "6b5095f5c9e527f2",
        "type": "function",
        "z": "94f57d35bb1b70bc",
        "name": "calibracion",
        "func": "let calibracion = global.get(\"calibracion\")\n\nif(calibracion){\n\n    return null;\n\n}else{\n\n    return msg;\n\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1770,
        "y": 160,
        "wires": [
            [
                "fb99332f155d6504"
            ]
        ]
    },
    {
        "id": "1d08f70750298931",
        "type": "function",
        "z": "94f57d35bb1b70bc",
        "name": "Contador N1",
        "func": "var cont = global.get(\"contador_mensajes_N1\");\ncont = cont + 1;\nglobal.set(\"contador_mensajes_N1\", cont);\nmsg.payload = global.get(\"contador_mensajes_N1\");\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\nglobal.set(\"contador_mensajes_N1\", 0);\n",
        "finalize": "",
        "libs": [],
        "x": 310,
        "y": 680,
        "wires": [
            [
                "a25a1c5f4eba1b45"
            ]
        ]
    },
    {
        "id": "a25a1c5f4eba1b45",
        "type": "ui_text",
        "z": "94f57d35bb1b70bc",
        "group": "43eefe2eef3aec0e",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Mensajes recibidos EMG",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": 16,
        "color": "#000000",
        "x": 650,
        "y": 680,
        "wires": []
    },
    {
        "id": "aaf581c3f220bc6f",
        "type": "function",
        "z": "94f57d35bb1b70bc",
        "name": "Contador N8",
        "func": "var cont = global.get(\"contador_mensajes_N8\");\ncont = cont + 1;\nglobal.set(\"contador_mensajes_N8\", cont);\nmsg.payload = global.get(\"contador_mensajes_N8\");\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\nglobal.set(\"contador_mensajes_N1\", 0);\n",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 1440,
        "wires": [
            [
                "7ee88ed82b51839d"
            ]
        ]
    },
    {
        "id": "7ee88ed82b51839d",
        "type": "ui_text",
        "z": "94f57d35bb1b70bc",
        "group": "43eefe2eef3aec0e",
        "order": 6,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Mensajes recibidos N8",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": 16,
        "color": "#000000",
        "x": 720,
        "y": 1440,
        "wires": []
    },
    {
        "id": "fa9b4b4c104ba108",
        "type": "function",
        "z": "94f57d35bb1b70bc",
        "name": "Contador N7",
        "func": "var cont = global.get(\"contador_mensajes_N7\");\ncont = cont + 1;\nglobal.set(\"contador_mensajes_N7\", cont);\nmsg.payload = global.get(\"contador_mensajes_N7\");\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\nglobal.set(\"contador_mensajes_N1\", 0);\n",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 1540,
        "wires": [
            [
                "2c1442282418192d"
            ]
        ]
    },
    {
        "id": "2c1442282418192d",
        "type": "ui_text",
        "z": "94f57d35bb1b70bc",
        "group": "43eefe2eef3aec0e",
        "order": 5,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Mensajes recibidos N7",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": 16,
        "color": "#000000",
        "x": 720,
        "y": 1540,
        "wires": []
    },
    {
        "id": "770a4af33e069998",
        "type": "comment",
        "z": "94f57d35bb1b70bc",
        "name": "GENERAR TXT CON DATOS",
        "info": "",
        "x": 2320,
        "y": 940,
        "wires": []
    },
    {
        "id": "d1a53d29cb5d3550",
        "type": "ui_dropdown",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "label": "Canales",
        "tooltip": "",
        "place": "Seleccione",
        "group": "6b9ae3dc211019f4",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "EMG",
                "value": 1,
                "type": "num"
            },
            {
                "label": "EMG1",
                "value": 2,
                "type": "num"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 1780,
        "y": 700,
        "wires": [
            [
                "235f7ad76f7ec0d7"
            ]
        ]
    },
    {
        "id": "235f7ad76f7ec0d7",
        "type": "function",
        "z": "94f57d35bb1b70bc",
        "name": "guarda canal",
        "func": "global.set(\"canal\", msg.payload)\n\nreturn null;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2010,
        "y": 700,
        "wires": [
            []
        ]
    },
    {
        "id": "19f8018d0350a14a",
        "type": "mqtt in",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "topic": "/N1/EMG1/data",
        "qos": "1",
        "datatype": "auto-detect",
        "broker": "9feb18610cd75adc",
        "nl": false,
        "rap": true,
        "rh": "2",
        "inputs": 0,
        "x": 100,
        "y": 900,
        "wires": [
            [
                "0adaa4403421b903",
                "a84f2ea4ce0563a1",
                "cc357b1d3ac8822a",
                "039cd4dda37cd245"
            ]
        ]
    },
    {
        "id": "0adaa4403421b903",
        "type": "function",
        "z": "94f57d35bb1b70bc",
        "name": "Guardar Escalados TXT N1 EMG1",
        "func": "let calibracion = global.get(\"calibracion\")\nlet limitemin = global.get(\"limiteminEMG1\");\nlet limitemax = global.get(\"limitemaxEMG1\");\n\n// Función para mapear el valor\nfunction mapRange(value, fromMin, fromMax, toMin, toMax) {\n\n    let mapdata = toMin + ((value - fromMin) * (toMax - toMin)) / (fromMax - fromMin);\n\n    if (mapdata < 0.0){    \n        mapdata = 0.0\n    }\n\n    return parseFloat(mapdata.toFixed(2));\n}\n\n\nif (!(calibracion)) {\n\n    var path = global.get('folder_path');\n        \n    msg.filename = path + `/EMG1.txt`;\n\n    var datos = msg.payload.data;\n    const indice = msg.payload.index;\n    var n = (indice * datos.length) + 1;\n    var texto = \"\";\n\n\n    for (let index = 0; index < datos.length; index++) {\n\n        let datamap = mapRange(datos[index], limitemin, limitemax, 0, 100);\n\n        texto = texto + n + \",\" + datamap + \"\\n\";\n        n = n + 1;\n    }\n    msg.payload = texto;\n    return msg;\n\n}else{\n\n    return null;\n\n}\n\n\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 920,
        "wires": [
            [
                "3170091ec3cc8b1b"
            ]
        ]
    },
    {
        "id": "3170091ec3cc8b1b",
        "type": "file",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "filename": "filename",
        "filenameType": "msg",
        "appendNewline": false,
        "createDir": false,
        "overwriteFile": "false",
        "encoding": "none",
        "x": 640,
        "y": 920,
        "wires": [
            []
        ]
    },
    {
        "id": "a84f2ea4ce0563a1",
        "type": "function",
        "z": "94f57d35bb1b70bc",
        "name": "Contador N1",
        "func": "var cont = global.get(\"contador_mensajes_N1_EMG1\");\ncont = cont + 1;\nglobal.set(\"contador_mensajes_N1_EMG1\", cont);\nmsg.payload = global.get(\"contador_mensajes_N1_EMG1\");\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\nglobal.set(\"contador_mensajes_N1_EMG1\", 0);\n",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 960,
        "wires": [
            [
                "5bb3d29e53f950a7"
            ]
        ]
    },
    {
        "id": "5bb3d29e53f950a7",
        "type": "ui_text",
        "z": "94f57d35bb1b70bc",
        "group": "43eefe2eef3aec0e",
        "order": 3,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Mensajes recibidos EMG1",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": 16,
        "color": "#000000",
        "x": 650,
        "y": 960,
        "wires": []
    },
    {
        "id": "6b92f20f87822364",
        "type": "ui_chart",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "group": "caecf63d5e0219ee",
        "order": 10,
        "width": 0,
        "height": 0,
        "label": "Datos Escalados EMG1",
        "chartType": "line",
        "legend": "false",
        "xformat": "auto",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "0",
        "ymax": "100",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "3600",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "tamanochart",
        "x": 890,
        "y": 880,
        "wires": [
            []
        ]
    },
    {
        "id": "cc357b1d3ac8822a",
        "type": "function",
        "z": "94f57d35bb1b70bc",
        "name": "Extraer datos EMG",
        "func": "var datos = msg.payload.data;\nconst indice = msg.payload.index; // Aquí está el índice de la serie\nvar n = (indice * datos.length) + 1;\n\n// Obtener el historial de datos EMG y sus índices\nvar dataArray = global.get(\"historicoEMG1\") || [];\nvar labelArray = global.get(\"historicoEMG1_index\") || [];\nconst maxHistorial = 300; // Máxima cantidad de puntos en el historial\n\n// Función para actualizar el gráfico en bloques de 10 datos con ventana deslizante\nfunction actualizarGrafico(index) {\n    if (index < datos.length) {\n        for (let i = 0; i < 10 && index < datos.length; i++, index++) {\n            // Agregar el nuevo punto al historial\n            dataArray.push(datos[index]);\n            labelArray.push(n);\n            n++;\n\n            // Si el historial excede el máximo permitido, eliminar el primer punto\n            if (dataArray.length > maxHistorial) {\n                dataArray.shift();\n                labelArray.shift();\n            }\n        }\n\n        // Construir el objeto de datos para el nodo Chart\n        var chartData = [{\n            \"series\": [\"EMG1\"],\n            \"data\": [dataArray.slice()], // Copiar el array para evitar problemas de referencia\n            \"labels\": labelArray.slice()\n        }];\n\n        var msgClone = RED.util.cloneMessage(msg);\n        msgClone.payload = chartData;\n\n        node.send(msgClone);  // Enviar los datos al gráfico\n\n        // Llamar a la función nuevamente después de 200 ms para el siguiente bloque\n        setTimeout(() => actualizarGrafico(index), 200);\n    }\n}\n\n// Iniciar la actualización del gráfico\nactualizarGrafico(0);\n\n// Guardar el historial actualizado en variables globales\nglobal.set(\"historicoEMG1\", dataArray);\nglobal.set(\"historicoEMG1_index\", labelArray);\n\nreturn null;  // No es necesario devolver msg ya que se ha enviado dentro del bucle\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\n\nglobal.set(\"historicoEMG1\", []);\nglobal.set(\"historicoEMG1_index\", []);",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 880,
        "wires": [
            [
                "6426e3df449571af",
                "575e7a955ef6f2ad"
            ]
        ]
    },
    {
        "id": "6426e3df449571af",
        "type": "function",
        "z": "94f57d35bb1b70bc",
        "name": "escalar",
        "func": "// Obtener los límites de mapeo desde las variables globales\nlet limitemin = global.get(\"limiteminEMG1\");\nlet limitemax = global.get(\"limitemaxEMG1\");\n\n// Función para mapear el valor\nfunction mapRange(value, fromMin, fromMax, toMin, toMax) {\n    return toMin + ((value - fromMin) * (toMax - toMin)) / (fromMax - fromMin);\n}\n\n// Mapeo de cada valor en la serie de datos\nmsg.payload.forEach(seriesObj => {\n    seriesObj.data = seriesObj.data.map(dataArray =>\n        dataArray.map(value => {\n            let mappedValue = mapRange(value, limitemin, limitemax, 0, 100);\n            // Si el valor mapeado es menor que 0, se establece en 0\n            mappedValue < 0 ? 0 : mappedValue;\n            return parseFloat(mappedValue.toFixed(2));\n        })\n    );\n});\n// Devolver el mensaje con los datos mapeados\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 640,
        "y": 880,
        "wires": [
            [
                "6b92f20f87822364"
            ]
        ]
    },
    {
        "id": "575e7a955ef6f2ad",
        "type": "ui_chart",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "group": "caecf63d5e0219ee",
        "order": 12,
        "width": 0,
        "height": 0,
        "label": "Datos Directos EMG1",
        "chartType": "line",
        "legend": "false",
        "xformat": "auto",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "",
        "ymax": "",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "3600",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "",
        "x": 680,
        "y": 840,
        "wires": [
            []
        ]
    },
    {
        "id": "275f84c5aa6a7189",
        "type": "function",
        "z": "94f57d35bb1b70bc",
        "name": "calcular maximos",
        "func": "let calibracion = global.get(\"calibracion\")\n\nif(calibracion){\n    // Obtener los datos del mensaje\n    var datos = msg.payload.data;\n    const indice = msg.payload.index;\n    var n = (indice * datos.length) + 1;\n\n    // Obtener el historial de datos EMG y sus índices\n    var dataArray = global.get(\"historicoEMG1calibracion\") || [];\n    var maximosArray = [];\n\n    const tamanoBloque = 300; // Tamaño de cada bloque\n    const maxHistorial = 100; // Número máximo de bloques (para limitar el tamaño de maximosArray)\n\n    // Agregar nuevos datos al historial\n    for (let i = 0; i < datos.length; i++) {\n        dataArray.push(datos[i]);\n        // Si el historial excede el tamaño del bloque, eliminar los datos más antiguos\n        if (dataArray.length > tamanoBloque * (maxHistorial - 1)) {\n            dataArray.shift();\n        }\n    }\n\n    // Función para calcular el valor máximo de un bloque\n    function calcularMaximo(data) {\n        return data.length ? Math.max(...data) : 0;\n    }\n\n    // Procesar los datos en bloques y calcular los máximos\n    function procesarDatosEnBloques(dataArray, tamanoBloque) {\n        var maximos = [];\n        for (let i = 0; i < dataArray.length; i += tamanoBloque) {\n            let bloque = dataArray.slice(i, i + tamanoBloque);\n            let maximoBloque = calcularMaximo(bloque);\n            maximos.push(maximoBloque);\n        }\n        return maximos;\n    }\n\n    // Calcular los valores máximos de los bloques\n    var maximosBloques = procesarDatosEnBloques(dataArray, tamanoBloque);\n\n    // Mantener solo los últimos maxHistorial valores máximos\n    if (maximosArray.length >= maxHistorial) {\n        maximosArray.shift(); // Eliminar el valor más antiguo\n    }\n    maximosArray = maximosArray.concat(maximosBloques);\n\n    // Guardar el historial actualizado y los valores máximos\n    global.set(\"historicoEMG1calibracion\", dataArray);\n\n\n\n    var maxMaximos = calcularMaximo(maximosArray);\n\n    var maxMaximosround = parseFloat(maxMaximos.toFixed(2));\n\n    global.set(\"maxMaximosround\", maxMaximosround);\n\n    return msg = { payload: maxMaximosround };\n\n}else{\n\n    return null;\n\n}\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\nglobal.set(\"historicoEMG1calibracion\", []);",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 780,
        "wires": [
            [
                "d7533aba4c107f3b"
            ]
        ]
    },
    {
        "id": "d7533aba4c107f3b",
        "type": "link out",
        "z": "94f57d35bb1b70bc",
        "name": "link out 5",
        "mode": "link",
        "links": [
            "e4493e88641e9847",
            "515de2cfff21b4a9",
            "88a073fa2f38a33f"
        ],
        "x": 585,
        "y": 780,
        "wires": []
    },
    {
        "id": "e87d635b6de5346d",
        "type": "ui_text",
        "z": "94f57d35bb1b70bc",
        "group": "6b9ae3dc211019f4",
        "order": 5,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Valor maximo EMG1",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": 16,
        "color": "#000000",
        "x": 1820,
        "y": 540,
        "wires": []
    },
    {
        "id": "88a073fa2f38a33f",
        "type": "link in",
        "z": "94f57d35bb1b70bc",
        "name": "link in 6",
        "links": [
            "d7533aba4c107f3b",
            "63f8769055919557"
        ],
        "x": 1645,
        "y": 440,
        "wires": [
            [
                "e87d635b6de5346d"
            ]
        ]
    },
    {
        "id": "a29d5eb15fb1786a",
        "type": "inject",
        "z": "94f57d35bb1b70bc",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "0",
        "payloadType": "num",
        "x": 1450,
        "y": 480,
        "wires": [
            [
                "63f8769055919557"
            ]
        ]
    },
    {
        "id": "63f8769055919557",
        "type": "link out",
        "z": "94f57d35bb1b70bc",
        "name": "link out 6",
        "mode": "link",
        "links": [
            "88a073fa2f38a33f",
            "079e0dcfe31aa86e"
        ],
        "x": 1565,
        "y": 480,
        "wires": []
    },
    {
        "id": "ec8ce8504cd355b2",
        "type": "function",
        "z": "94f57d35bb1b70bc",
        "name": "calibracion",
        "func": "let calibracion = global.get(\"calibracion\")\nlet canal = global.get(\"canal\")\n\nif (calibracion && canal === 1){\n\n    \n    return msg;\n\n}else{\n\n    return null;\n\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 230,
        "y": 740,
        "wires": [
            [
                "0dc16ba9bf3c8242"
            ]
        ]
    },
    {
        "id": "039cd4dda37cd245",
        "type": "function",
        "z": "94f57d35bb1b70bc",
        "name": "calibracion",
        "func": "let calibracion = global.get(\"calibracion\")\nlet canal = global.get(\"canal\")\n\nif (calibracion && canal === 2){\n\n    return msg;\n    \n\n}else{\n\n    return null;\n\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 230,
        "y": 780,
        "wires": [
            [
                "275f84c5aa6a7189"
            ]
        ]
    },
    {
        "id": "617c98694afa5a18",
        "type": "ui_spacer",
        "z": "94f57d35bb1b70bc",
        "name": "spacer",
        "group": "a1471ef42c395f43",
        "order": 5,
        "width": 14,
        "height": 1
    },
    {
        "id": "63fdb834d584d532",
        "type": "ui_spacer",
        "z": "94f57d35bb1b70bc",
        "name": "spacer",
        "group": "a1471ef42c395f43",
        "order": 7,
        "width": 14,
        "height": 1
    },
    {
        "id": "b916e0d0927c9469",
        "type": "ui_spacer",
        "z": "94f57d35bb1b70bc",
        "name": "spacer",
        "group": "caecf63d5e0219ee",
        "order": 3,
        "width": 20,
        "height": 1
    },
    {
        "id": "7896bccfd0887831",
        "type": "ui_spacer",
        "z": "94f57d35bb1b70bc",
        "name": "spacer",
        "group": "caecf63d5e0219ee",
        "order": 4,
        "width": 20,
        "height": 1
    },
    {
        "id": "4c68df0f123592a3",
        "type": "ui_spacer",
        "z": "94f57d35bb1b70bc",
        "name": "spacer",
        "group": "caecf63d5e0219ee",
        "order": 5,
        "width": 20,
        "height": 1
    },
    {
        "id": "70206f278570a75a",
        "type": "ui_spacer",
        "z": "94f57d35bb1b70bc",
        "name": "spacer",
        "group": "caecf63d5e0219ee",
        "order": 6,
        "width": 20,
        "height": 1
    },
    {
        "id": "15aa73475d90f2d6",
        "type": "ui_spacer",
        "z": "94f57d35bb1b70bc",
        "name": "spacer",
        "group": "caecf63d5e0219ee",
        "order": 7,
        "width": 20,
        "height": 1
    },
    {
        "id": "83d1ec0f45e22cfa",
        "type": "ui_spacer",
        "z": "94f57d35bb1b70bc",
        "name": "spacer",
        "group": "caecf63d5e0219ee",
        "order": 8,
        "width": 20,
        "height": 1
    },
    {
        "id": "132d9587eb71831e",
        "type": "ui_spacer",
        "z": "94f57d35bb1b70bc",
        "name": "spacer",
        "group": "caecf63d5e0219ee",
        "order": 9,
        "width": 20,
        "height": 1
    },
    {
        "id": "9feb18610cd75adc",
        "type": "mqtt-broker",
        "name": "",
        "broker": "localhost",
        "port": "1883",
        "clientid": "",
        "autoConnect": true,
        "usetls": false,
        "protocolVersion": "5",
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willPayload": "",
        "willMsg": {},
        "userProps": "",
        "sessionExpiry": ""
    },
    {
        "id": "caecf63d5e0219ee",
        "type": "ui_group",
        "name": "EMG",
        "tab": "b4eb9977142bc8ea",
        "order": 2,
        "disp": true,
        "width": 20,
        "collapse": false,
        "className": "tamanogrupochart"
    },
    {
        "id": "a1471ef42c395f43",
        "type": "ui_group",
        "name": "Datos",
        "tab": "b4eb9977142bc8ea",
        "order": 1,
        "disp": true,
        "width": 14,
        "collapse": false,
        "className": ""
    },
    {
        "id": "43eefe2eef3aec0e",
        "type": "ui_group",
        "name": "Seguimiento",
        "tab": "b4eb9977142bc8ea",
        "order": 4,
        "disp": true,
        "width": 14,
        "collapse": false,
        "className": ""
    },
    {
        "id": "6b9ae3dc211019f4",
        "type": "ui_group",
        "name": "Calibración",
        "tab": "b4eb9977142bc8ea",
        "order": 3,
        "disp": true,
        "width": 14,
        "collapse": false,
        "className": ""
    },
    {
        "id": "b4eb9977142bc8ea",
        "type": "ui_tab",
        "name": "Toma de muestras",
        "icon": "fa-user-md",
        "order": 1,
        "disabled": false,
        "hidden": false
    }
]
```

Los resultados que se obtienen de este cliente MQTT principalmente son los frames del video y los archivos .txt de los datos de los EMG y las IMU
